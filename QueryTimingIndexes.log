Regular Queries

Query 1

"Sort  (cost=149.38..154.38 rows=2000 width=30) (actual time=5.002..5.141 rows=2000 loops=1)"
"  Sort Key: fi.flightcode, f.departuredate"
"  Sort Method: quicksort  Memory: 174kB"
"  ->  Hash Join  (cost=3.25..39.72 rows=2000 width=30) (actual time=0.075..1.769 rows=2000 loops=1)"
"        Hash Cond: ((f.flightcode)::text = (fi.flightcode)::text)"
"        ->  Seq Scan on flight f  (cost=0.00..31.00 rows=2000 width=14) (actual time=0.007..0.344 rows=2000 loops=1)"
"        ->  Hash  (cost=2.00..2.00 rows=100 width=22) (actual time=0.056..0.057 rows=100 loops=1)"
"              Buckets: 1024  Batches: 1  Memory Usage: 14kB"
"              ->  Seq Scan on flightinfo fi  (cost=0.00..2.00 rows=100 width=22) (actual time=0.006..0.021 rows=100 loops=1)"
"Planning Time: 0.271 ms"
"Execution Time: 5.277 ms"


Query 2

"Sort  (cost=11031.73..11156.73 rows=50000 width=26) (actual time=100.803..102.120 rows=49076 loops=1)"
"  Sort Key: c.customerid"
"  Sort Method: quicksort  Memory: 3859kB"
"  ->  HashAggregate  (cost=6629.32..7129.32 rows=50000 width=26) (actual time=91.329..94.286 rows=49076 loops=1)"
"        Group Key: c.customerid"
"        Batches: 1  Memory Usage: 5905kB"
"        ->  Hash Join  (cost=1434.00..5629.81 rows=199902 width=22) (actual time=17.277..58.946 rows=199902 loops=1)"
"              Hash Cond: (t.customerid = c.customerid)"
"              ->  Seq Scan on ticket t  (cost=0.00..3671.02 rows=199902 width=8) (actual time=0.009..6.295 rows=199902 loops=1)"
"              ->  Hash  (cost=809.00..809.00 rows=50000 width=18) (actual time=17.249..17.249 rows=50000 loops=1)"
"                    Buckets: 65536  Batches: 1  Memory Usage: 2968kB"
"                    ->  Seq Scan on customer c  (cost=0.00..809.00 rows=50000 width=18) (actual time=0.004..6.197 rows=50000 loops=1)"
"Planning Time: 0.429 ms"
"Execution Time: 103.584 ms"


Query 3

"GroupAggregate  (cost=625.65..656.97 rows=1392 width=36) (actual time=16.849..17.903 rows=1134 loops=1)"
"  Group Key: ticket.customerid"
"  ->  Sort  (cost=625.65..629.13 rows=1392 width=8) (actual time=16.835..16.928 rows=1159 loops=1)"
"        Sort Key: ticket.customerid"
"        Sort Method: quicksort  Memory: 85kB"
"        ->  Merge Join  (cost=1.11..552.97 rows=1392 width=8) (actual time=0.196..16.377 rows=1159 loops=1)"
"              Merge Cond: (ticket.ticketid = review.ticketid)"
"              ->  Nested Loop  (cost=0.72..25048.56 rows=92915 width=8) (actual time=0.177..13.808 rows=1160 loops=1)"
"                    ->  Index Scan using ticket_pkey on ticket  (cost=0.42..6877.95 rows=199902 width=8) (actual time=0.013..1.089 rows=2998 loops=1)"
"                    ->  Memoize  (cost=0.30..0.32 rows=1 width=4) (actual time=0.004..0.004 rows=0 loops=2998)"
"                          Cache Key: ticket.customerid"
"                          Cache Mode: logical"
"                          Hits: 88  Misses: 2910  Evictions: 0  Overflows: 0  Memory Usage: 234kB"
"                          ->  Index Only Scan using rewardscustomer_pkey on rewardscustomer  (cost=0.29..0.31 rows=1 width=4) (actual time=0.003..0.003 rows=0 loops=2910)"
"                                Index Cond: (customerid = ticket.customerid)"
"                                Heap Fetches: 0"
"              ->  Index Scan using idx_review_ticketid on review  (cost=0.28..165.17 rows=2995 width=8) (actual time=0.011..1.433 rows=2995 loops=1)"
"Planning Time: 1.610 ms"
"Execution Time: 18.251 ms"



Query 4

"Sort  (cost=55312.46..55520.80 rows=83335 width=30) (actual time=318.326..318.590 rows=10717 loops=1)"
"  Sort Key: (count(t_1.ticketid)) DESC"
"  Sort Method: quicksort  Memory: 1037kB"
"  ->  Merge Join  (cost=8424.99..46506.23 rows=83335 width=30) (actual time=127.373..317.190 rows=10717 loops=1)"
"        Merge Cond: (td.customerid = c.customerid)"
"        ->  Subquery Scan on td  (cost=1.93..36830.63 rows=1000 width=8) (actual time=0.442..187.167 rows=49068 loops=1)"
"              Filter: (td.rn = 1)"
"              ->  WindowAgg  (cost=1.93..34331.86 rows=199902 width=24) (actual time=0.441..184.906 rows=49068 loops=1)"
"                    Run Condition: (row_number() OVER (?) <= 1)"
"                    ->  Incremental Sort  (cost=1.93..30833.57 rows=199902 width=16) (actual time=0.436..165.078 rows=193714 loops=1)"
"                          Sort Key: t.customerid, (count(*)) DESC"
"                          Presorted Key: t.customerid"
"                          Full-sort Groups: 5718  Sort Method: quicksort  Average Memory: 26kB  Peak Memory: 26kB"
"                          ->  GroupAggregate  (cost=1.29..25259.39 rows=199902 width=16) (actual time=0.256..142.679 rows=193727 loops=1)"
"                                Group Key: t.customerid, fi.destination"
"                                ->  Incremental Sort  (cost=1.29..21761.11 rows=199902 width=8) (actual time=0.250..116.098 rows=199890 loops=1)"
"                                      Sort Key: t.customerid, fi.destination"
"                                      Presorted Key: t.customerid"
"                                      Full-sort Groups: 5879  Sort Method: quicksort  Average Memory: 26kB  Peak Memory: 26kB"
"                                      ->  Nested Loop  (cost=0.86..16186.93 rows=199902 width=8) (actual time=0.043..92.229 rows=199902 loops=1)"
"                                            ->  Nested Loop  (cost=0.71..11202.03 rows=199902 width=10) (actual time=0.033..56.872 rows=199902 loops=1)"
"                                                  ->  Index Only Scan using idx_ticket_customerid_flightid on ticket t  (cost=0.42..5614.95 rows=199902 width=8) (actual time=0.015..16.149 rows=199902 loops=1)"
"                                                        Heap Fetches: 11622"
"                                                  ->  Memoize  (cost=0.29..0.31 rows=1 width=10) (actual time=0.000..0.000 rows=1 loops=199902)"
"                                                        Cache Key: t.flightid"
"                                                        Cache Mode: logical"
"                                                        Hits: 197903  Misses: 1999  Evictions: 0  Overflows: 0  Memory Usage: 217kB"
"                                                        ->  Index Scan using flight_pkey on flight f  (cost=0.28..0.30 rows=1 width=10) (actual time=0.002..0.002 rows=1 loops=1999)"
"                                                              Index Cond: (flightid = t.flightid)"
"                                            ->  Memoize  (cost=0.15..0.18 rows=1 width=10) (actual time=0.000..0.000 rows=1 loops=199902)"
"                                                  Cache Key: f.flightcode"
"                                                  Cache Mode: logical"
"                                                  Hits: 199802  Misses: 100  Evictions: 0  Overflows: 0  Memory Usage: 12kB"
"                                                  ->  Index Scan using flightinfo_pkey on flightinfo fi  (cost=0.14..0.17 rows=1 width=10) (actual time=0.001..0.001 rows=1 loops=100)"
"                                                        Index Cond: ((flightcode)::text = (f.flightcode)::text)"
"        ->  Sort  (cost=8423.07..8464.73 rows=16667 width=26) (actual time=126.915..127.462 rows=10717 loops=1)"
"              Sort Key: c.customerid"
"              Sort Method: quicksort  Memory: 953kB"
"              ->  HashAggregate  (cost=6629.32..7254.32 rows=16667 width=26) (actual time=107.587..123.575 rows=10717 loops=1)"
"                    Group Key: c.customerid"
"                    Filter: (count(t_1.ticketid) > 5)"
"                    Batches: 1  Memory Usage: 5905kB"
"                    Rows Removed by Filter: 38359"
"                    ->  Hash Join  (cost=1434.00..5629.81 rows=199902 width=22) (actual time=15.868..68.184 rows=199902 loops=1)"
"                          Hash Cond: (t_1.customerid = c.customerid)"
"                          ->  Seq Scan on ticket t_1  (cost=0.00..3671.02 rows=199902 width=8) (actual time=0.006..7.074 rows=199902 loops=1)"
"                          ->  Hash  (cost=809.00..809.00 rows=50000 width=18) (actual time=15.796..15.796 rows=50000 loops=1)"
"                                Buckets: 65536  Batches: 1  Memory Usage: 2968kB"
"                                ->  Seq Scan on customer c  (cost=0.00..809.00 rows=50000 width=18) (actual time=0.004..5.092 rows=50000 loops=1)"
"Planning Time: 1.308 ms"
"Execution Time: 319.230 ms"


Query 5

"Update on flightinfo  (cost=0.00..2.25 rows=0 width=0) (actual time=0.073..0.074 rows=0 loops=1)"
"  ->  Seq Scan on flightinfo  (cost=0.00..2.25 rows=1 width=14) (actual time=0.015..0.021 rows=1 loops=1)"
"        Filter: ((flightcode)::text = 'LH594'::text)"
"        Rows Removed by Filter: 99"
"Planning Time: 0.081 ms"
"Execution Time: 0.121 ms"


Query 6

"Update on flight  (cost=4.35..15.71 rows=0 width=0) (actual time=0.633..0.633 rows=0 loops=1)"
"  ->  Bitmap Heap Scan on flight  (cost=4.35..15.71 rows=9 width=10) (actual time=0.080..0.106 rows=9 loops=1)"
"        Recheck Cond: (departuredate = '2024-07-22'::date)"
"        Heap Blocks: exact=7"
"        ->  Bitmap Index Scan on idx_flight_departuredate  (cost=0.00..4.34 rows=9 width=0) (actual time=0.062..0.063 rows=9 loops=1)"
"              Index Cond: (departuredate = '2024-07-22'::date)"
"Planning Time: 0.623 ms"
"Execution Time: 0.686 ms"


Query 7

"Delete on review  (cost=1.33..355.45 rows=0 width=0) (actual time=11.347..11.349 rows=0 loops=1)"
"  ->  Merge Semi Join  (cost=1.33..355.45 rows=198 width=18) (actual time=0.179..11.003 rows=215 loops=1)"
"        Merge Cond: (review.ticketid = ticket.ticketid)"
"        ->  Index Scan using idx_review_ticketid on review  (cost=0.28..165.25 rows=3000 width=10) (actual time=0.016..1.258 rows=3000 loops=1)"
"        ->  Nested Loop  (cost=0.71..12473.97 rows=13200 width=16) (actual time=0.150..9.259 rows=216 loops=1)"
"              ->  Index Scan using ticket_pkey on ticket  (cost=0.42..6879.42 rows=200000 width=14) (actual time=0.016..2.116 rows=3009 loops=1)"
"              ->  Memoize  (cost=0.29..0.31 rows=1 width=10) (actual time=0.002..0.002 rows=0 loops=3009)"
"                    Cache Key: ticket.flightid"
"                    Cache Mode: logical"
"                    Hits: 1443  Misses: 1566  Evictions: 0  Overflows: 0  Memory Usage: 110kB"
"                    ->  Index Scan using flight_pkey on flight  (cost=0.28..0.30 rows=1 width=10) (actual time=0.003..0.003 rows=0 loops=1566)"
"                          Index Cond: (flightid = ticket.flightid)"
"                          Filter: (departuredate < '2024-06-04'::date)"
"                          Rows Removed by Filter: 1"
"Planning Time: 4.065 ms"
"Execution Time: 11.685 ms"
"Delete on ticket  (cost=19.60..4217.71 rows=0 width=0) (actual time=44.586..44.588 rows=0 loops=1)"
"  ->  Hash Join  (cost=19.60..4217.71 rows=13200 width=12) (actual time=0.185..35.554 rows=14151 loops=1)"
"        Hash Cond: (ticket.flightid = flight.flightid)"
"        ->  Seq Scan on ticket  (cost=0.00..3672.00 rows=200000 width=10) (actual time=0.011..22.027 rows=200000 loops=1)"
"        ->  Hash  (cost=17.95..17.95 rows=132 width=10) (actual time=0.157..0.158 rows=140 loops=1)"
"              Buckets: 1024  Batches: 1  Memory Usage: 15kB"
"              ->  Bitmap Heap Scan on flight  (cost=5.30..17.95 rows=132 width=10) (actual time=0.029..0.105 rows=140 loops=1)"
"                    Recheck Cond: (departuredate < '2024-06-04'::date)"
"                    Heap Blocks: exact=11"
"                    ->  Bitmap Index Scan on idx_flight_departuredate  (cost=0.00..5.27 rows=132 width=0) (actual time=0.017..0.017 rows=140 loops=1)"
"                          Index Cond: (departuredate < '2024-06-04'::date)"
"Planning Time: 0.462 ms"
"Trigger for constraint review_ticketid_fkey: time=59.465 calls=14151"
"Execution Time: 104.548 ms"
"Delete on flight  (cost=5.30..17.95 rows=0 width=0) (actual time=0.462..0.463 rows=0 loops=1)"
"  ->  Bitmap Heap Scan on flight  (cost=5.30..17.95 rows=132 width=6) (actual time=0.045..0.138 rows=140 loops=1)"
"        Recheck Cond: (departuredate < '2024-06-04'::date)"
"        Heap Blocks: exact=11"
"        ->  Bitmap Index Scan on idx_flight_departuredate  (cost=0.00..5.27 rows=132 width=0) (actual time=0.028..0.028 rows=140 loops=1)"
"              Index Cond: (departuredate < '2024-06-04'::date)"
"Planning Time: 0.130 ms"
"Trigger for constraint ticket_flightid_fkey: time=24.554 calls=140"
"Execution Time: 25.069 ms"


Query 8

"Hash Join  (cost=71.00..4269.11 rows=200000 width=4) (actual time=1.190..34.806 rows=200000 loops=1)"
"  Hash Cond: (ticket.flightid = flight.flightid)"
"  ->  Seq Scan on ticket  (cost=0.00..3672.00 rows=200000 width=8) (actual time=0.006..8.345 rows=200000 loops=1)"
"  ->  Hash  (cost=46.00..46.00 rows=2000 width=4) (actual time=1.176..1.176 rows=2000 loops=1)"
"        Buckets: 2048  Batches: 1  Memory Usage: 87kB"
"        ->  Seq Scan on flight  (cost=0.00..46.00 rows=2000 width=4) (actual time=0.008..0.896 rows=2000 loops=1)"
"              Filter: (departuredate > (CURRENT_DATE - '1 mon'::interval))"
"Planning Time: 1.169 ms"
"Execution Time: 63.876 ms"
"Delete on petcustomer  (cost=4130.00..4134.00 rows=0 width=0) (actual time=52.819..52.819 rows=0 loops=1)"
"  ->  Seq Scan on petcustomer  (cost=4130.00..4134.00 rows=50 width=6) (actual time=52.761..52.791 rows=6 loops=1)"
"        Filter: ((NOT (hashed SubPlan 1)) AND (NOT (hashed SubPlan 2)))"
"        Rows Removed by Filter: 194"
"        SubPlan 1"
"          ->  Seq Scan on flyingcustomers  (cost=0.00..3180.80 rows=228480 width=4) (actual time=0.012..14.020 rows=200000 loops=1)"
"        SubPlan 2"
"          ->  Seq Scan on rewardscustomer  (cost=0.00..328.00 rows=20000 width=4) (actual time=0.015..0.838 rows=20000 loops=1)"
"Planning Time: 0.569 ms"
"Execution Time: 53.126 ms"
"Delete on identification  (cost=4130.00..5820.00 rows=0 width=0) (actual time=64.158..64.159 rows=0 loops=1)"
"  ->  Seq Scan on identification  (cost=4130.00..5820.00 rows=17500 width=6) (actual time=50.131..61.826 rows=741 loops=1)"
"        Filter: ((NOT (hashed SubPlan 1)) AND (NOT (hashed SubPlan 2)))"
"        Rows Removed by Filter: 69259"
"        SubPlan 1"
"          ->  Seq Scan on flyingcustomers  (cost=0.00..3180.80 rows=228480 width=4) (actual time=0.016..11.478 rows=200000 loops=1)"
"        SubPlan 2"
"          ->  Seq Scan on rewardscustomer  (cost=0.00..328.00 rows=20000 width=4) (actual time=0.015..0.838 rows=20000 loops=1)"
"Planning Time: 0.832 ms"
"Execution Time: 64.452 ms"
"Delete on customer  (cost=4130.00..5189.00 rows=0 width=0) (actual time=61.599..61.600 rows=0 loops=1)"
"  ->  Seq Scan on customer  (cost=4130.00..5189.00 rows=12500 width=6) (actual time=53.330..59.958 rows=546 loops=1)"
"        Filter: ((NOT (hashed SubPlan 1)) AND (NOT (hashed SubPlan 2)))"
"        Rows Removed by Filter: 49454"
"        SubPlan 1"
"          ->  Seq Scan on flyingcustomers  (cost=0.00..3180.80 rows=228480 width=4) (actual time=0.010..11.116 rows=200000 loops=1)"
"        SubPlan 2"
"          ->  Seq Scan on rewardscustomer  (cost=0.00..328.00 rows=20000 width=4) (actual time=0.014..0.841 rows=20000 loops=1)"
"Planning Time: 0.320 ms"
"Trigger for constraint identification_customerid_fkey: time=5.244 calls=546"
"Trigger for constraint petcustomer_customerid_fkey: time=6.025 calls=546"
"Trigger for constraint rewardscustomer_customerid_fkey: time=2.700 calls=546"
"Trigger for constraint ticket_customerid_fkey: time=4.009 calls=546"
"Execution Time: 79.878 ms"
